import{az as U,M as j,N as g}from"./app-f059f5ee.js";import{m as B,c as b,r as d,M as c,N as m,O as a,a5 as o,$ as i,u as t,Q as q,ak as y,_ as P,X as Q,G as R}from"./framework-ca2ea75b.js";import{N as w}from"./Button-0c479d4f.js";import{N as C}from"./Alert-a57b1d6b.js";import{N as A}from"./Image-f9773cdd.js";import"./browser-2068d983.js";import"./resolve-slot-18f45683.js";import"./color-to-class-b0332f36.js";import"./Popover-6dd33703.js";import"./Scrollbar-730ca805.js";import"./use-false-until-truthy-c21144e5.js";import"./utils-2ce98bd0.js";import"./use-merged-state-d45576d8.js";function I(){const u=B(U,null);return u===null&&j("use-message","No outer <n-message-provider /> founded. See prerequisite in https://www.naiveui.com/en-US/os-theme/components/message for more details. If you want to use `useMessage` outside setup, please check https://www.naiveui.com/zh-CN/os-theme/components/message#Q-&-A."),u}const T=b({__name:"Request",setup(u){const _="https://alist.nn.ci/tool/aliyundrive/callback",k="76917ccccd4441c39457a04f6084fb2f";function f(){const e=new URL("https://open.aliyundrive.com/oauth/authorize");e.searchParams.set("client_id",k),e.searchParams.set("redirect_uri",_),e.searchParams.set("scope","user:base,file:all:read,file:all:write"),e.searchParams.set("response_type","code"),e.searchParams.set("state",""),window.open(e.toString(),"_blank")}const s=d(),S="https://api.nn.ci",v=d(!1);async function x(){try{v.value=!0;const n=await(await fetch(S+"/alist/ali_open/qr",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})})).json();s.value=n}catch(e){console.log(e),s.value={error:"error",qrCodeUrl:"",sid:""}}finally{v.value=!1}}const p=d(),h=d(!1),N=I();async function z(){var e;try{h.value=!0;const r=await(await fetch(`${S}/proxy/https://open.aliyundrive.com/oauth/qrcode/${(e=s.value)==null?void 0:e.sid}/status`)).json();if(p.value=r,r.status==="LoginSuccess"){const l=new URL(_);l.searchParams.set("code",r.authCode),window.open(l.toString(),"_blank")}else N.warning(r.status)}catch(n){console.log(n),N.error(String(n))}finally{h.value=!1}}return(e,n)=>(c(),m(t(g),{vertical:"",size:"large"},{default:a(()=>{var r,l;return[o(t(w),{size:"large",type:"primary",onClick:f,block:""},{default:a(()=>[i("Go to login")]),_:1}),o(t(w),{size:"large",type:"info",onClick:x,block:"",loading:v.value,disabled:!!s.value},{default:a(()=>[i("Scan QrCode ")]),_:1},8,["loading","disabled"]),(r=s.value)!=null&&r.error?(c(),m(t(C),{key:0,title:"Error",type:"error"},{default:a(()=>[i(q(s.value.error),1)]),_:1})):y("v-if",!0),(l=s.value)!=null&&l.qrCodeUrl?(c(),m(t(g),{key:1,vertical:""},{default:a(()=>[o(t(g),{justify:"center"},{default:a(()=>[o(t(A),{width:"300",src:s.value.qrCodeUrl},null,8,["src"])]),_:1}),o(t(C),{title:"Scan the QrCode",type:"info"},{default:a(()=>[i("Use AliyunDrive APP To Scan Then Click the Button Below")]),_:1}),o(t(w),{size:"large",onClick:z,type:"info",block:"",loading:h.value},{default:a(()=>[i("I have scan")]),_:1},8,["loading"])]),_:1})):y("v-if",!0),p.value&&p.value.status!=="LoginSuccess"?(c(),m(t(C),{key:2,title:"Warning",type:"warning"},{default:a(()=>[i(q(p.value.status),1)]),_:1})):y("v-if",!0)]}),_:1}))}});const L=P(T,[["__scopeId","data-v-21249173"],["__file","Request.vue"]]),M=b({__name:"request.html",setup(u){return(_,k)=>{const f=R("NaiveClient");return c(),Q("div",null,[o(f,null,{default:a(()=>[o(t(L))]),_:1})])}}}),Z=P(M,[["__file","request.html.vue"]]);export{Z as default};

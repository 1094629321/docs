import{c as S,b as U,u as t,N as s,O as n,P as i,a1 as a,S as l,Q as o,Z as f,a7 as u,Y as I,U as w,V as B,_ as T,F as O}from"./framework-4112b4b4.js";import{N as k}from"./Alert-3921367e.js";import{as as b,N as m}from"./app-ee2c1560.js";import{N}from"./Input-968fba7b.js";import{N as V}from"./Button-7a338fd3.js";import"./resolve-slot-6658b9ef.js";import"./browser-3466804d.js";import"./Scrollbar-2602c1b5.js";import"./use-merged-state-11bbb36c.js";import"./color-to-class-b0332f36.js";const c=p=>(w("data-v-611118eb"),p=p(),B(),p),j=c(()=>o("b",null,"client_id: ",-1)),D=c(()=>o("b",null,"client_secret: ",-1)),E=c(()=>o("b",null,"zone: ",-1)),G=c(()=>o("p",null,[o("b",null,"redirect_uri: "),a("https://alist.nn.ci/tool/onedrive/callback")],-1)),J=c(()=>o("b",null,"refresh_token:",-1)),A=c(()=>o("h3",null,"Get sharepoint site ID",-1)),F={key:2},L=c(()=>o("b",null,"site_id: ",-1)),Q=S({__name:"Callback",setup(p){const d=new URL(window.location.href),h=d.searchParams.get("code"),_=d.searchParams.get("state"),g=d.searchParams.get("error"),x=d.searchParams.get("error_description"),e=U({refreshToken:"",accessToken:"",error1:"",errorMessage1:"",siteUrl:"",siteId:"",error2:"",errorMessage2:"",gettingSiteId:!1});h&&_&&!g&&(()=>{fetch("https://api.nn.ci/alist/onedrive/get_refresh_token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:h,client:_})}).then(r=>r.json()).then(r=>{if(console.log(r),r.error){e.error1=r.error,e.errorMessage1=r.error_description;return}e.refreshToken=r.refresh_token,e.accessToken=r.access_token})})();const[C,M,v]=atob(_).split("::"),z=()=>{e.gettingSiteId=!0,fetch("https://api.nn.ci/alist/onedrive/get_site_id",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({site_url:e.siteUrl,access_token:e.accessToken,zone:v})}).then(r=>(e.gettingSiteId=!1,r.json())).then(r=>{if(r.error){e.error2=r.error,e.errorMessage2=r.error.message;return}e.siteId=r.id})};return(r,y)=>!t(h)||!t(_)||t(g)?(s(),n(t(k),{key:0,title:t(g)||"Error",type:"error"},{default:i(()=>[a(l(t(x)),1)]),_:1},8,["title"])):(s(),n(t(m),{key:1,vertical:"",size:"large"},{default:i(()=>[o("p",null,[j,a(l(t(C)),1)]),o("p",null,[D,a(l(t(M)),1)]),o("p",null,[E,a(l(t(v)),1)]),G,e.error1||e.errorMessage1?(s(),n(t(k),{key:0,title:e.error1,type:"error"},{default:i(()=>[a(l(e.errorMessage1),1)]),_:1},8,["title"])):f("v-if",!0),u(t(m),{vertical:""},{default:i(()=>[J,!e.refreshToken&&!e.errorMessage1?(s(),n(t(b),{key:0})):(s(),n(t(N),{key:1,type:"textarea",autosize:"",readonly:"",value:e.refreshToken},null,8,["value"]))]),_:1}),e.accessToken?(s(),n(t(m),{key:1,vertical:"",size:"large"},{default:i(()=>[A,e.error2||e.errorMessage2?(s(),n(t(k),{key:0,title:e.error2,type:"error"},{default:i(()=>[a(l(e.errorMessage2),1)]),_:1},8,["title"])):f("v-if",!0),u(t(N),{placeholder:"input site url (https://xx.sharepoint.xx/sites/xx)",size:"large",value:e.siteUrl,"onUpdate:value":y[0]||(y[0]=P=>e.siteUrl=P)},null,8,["value"]),u(t(V),{type:"primary",size:"large",onClick:z},{default:i(()=>[a("Get SiteID")]),_:1}),e.gettingSiteId?(s(),n(t(b),{key:1})):e.siteId?(s(),I("p",F,[L,a(l(e.siteId),1)])):f("v-if",!0)]),_:1})):f("v-if",!0)]),_:1}))}});const R=T(Q,[["__scopeId","data-v-611118eb"],["__file","Callback.vue"]]),Y=S({__name:"callback.html",setup(p){return(d,h)=>{const _=O("NaiveClient");return s(),I("div",null,[u(_,null,{default:i(()=>[u(t(R))]),_:1})])}}}),se=T(Y,[["__file","callback.html.vue"]]);export{se as default};

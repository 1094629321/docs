import{M as U,az as j,N as g}from"./app-120516e5.js";import{m as B,c as b,r as d,N as c,O as m,P as a,a7 as o,a1 as i,u as t,S as q,Z as y,_ as P,Y as R,F as A}from"./framework-4112b4b4.js";import{N as w}from"./Button-31a360a6.js";import{N as C}from"./Alert-9d717d37.js";import{N as I}from"./Image-de49c5fc.js";import"./browser-3ad18f45.js";import"./resolve-slot-6658b9ef.js";import"./color-to-class-b0332f36.js";import"./Popover-f353f2c0.js";import"./map-a08bb90f.js";import"./getTag-fde44b2c.js";import"./Scrollbar-d5a6186e.js";import"./use-false-until-truthy-dfa957a3.js";import"./utils-fe3d41a0.js";import"./use-merged-state-11bbb36c.js";import"./arrayReduce-865b0d3f.js";function Q(){const u=B(j,null);return u===null&&U("use-message","No outer <n-message-provider /> founded. See prerequisite in https://www.naiveui.com/en-US/os-theme/components/message for more details. If you want to use `useMessage` outside setup, please check https://www.naiveui.com/zh-CN/os-theme/components/message#Q-&-A."),u}const T=b({__name:"Request",setup(u){const _="https://alist.nn.ci/tool/aliyundrive/callback",S="76917ccccd4441c39457a04f6084fb2f";function f(){const e=new URL("https://open.aliyundrive.com/oauth/authorize");e.searchParams.set("client_id",S),e.searchParams.set("redirect_uri",_),e.searchParams.set("scope","user:base,file:all:read,file:all:write"),e.searchParams.set("response_type","code"),e.searchParams.set("state",""),window.open(e.toString(),"_blank")}const s=d(),k="https://api.nn.ci",v=d(!1);async function x(){try{v.value=!0;const n=await(await fetch(k+"/alist/ali_open/qr",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({})})).json();s.value=n}catch(e){console.log(e),s.value={error:"error",qrCodeUrl:"",sid:""}}finally{v.value=!1}}const p=d(),h=d(!1),N=Q();async function z(){var e;try{h.value=!0;const r=await(await fetch(`${k}/proxy/https://open.aliyundrive.com/oauth/qrcode/${(e=s.value)==null?void 0:e.sid}/status`)).json();if(p.value=r,r.status==="LoginSuccess"){const l=new URL(_);l.searchParams.set("code",r.authCode),window.open(l.toString(),"_blank")}else N.warning(r.status)}catch(n){console.log(n),N.error(String(n))}finally{h.value=!1}}return(e,n)=>(c(),m(t(g),{vertical:"",size:"large"},{default:a(()=>{var r,l;return[o(t(w),{size:"large",type:"primary",onClick:f,block:""},{default:a(()=>[i("Go to login")]),_:1}),o(t(w),{size:"large",type:"info",onClick:x,block:"",loading:v.value,disabled:!!s.value},{default:a(()=>[i("Scan QrCode ")]),_:1},8,["loading","disabled"]),(r=s.value)!=null&&r.error?(c(),m(t(C),{key:0,title:"Error",type:"error"},{default:a(()=>[i(q(s.value.error),1)]),_:1})):y("v-if",!0),(l=s.value)!=null&&l.qrCodeUrl?(c(),m(t(g),{key:1,vertical:""},{default:a(()=>[o(t(g),{justify:"center"},{default:a(()=>[o(t(I),{width:"300",src:s.value.qrCodeUrl},null,8,["src"])]),_:1}),o(t(C),{title:"Scan the QrCode",type:"info"},{default:a(()=>[i("Use AliyunDrive APP To Scan Then Click the Button Below")]),_:1}),o(t(w),{size:"large",onClick:z,type:"info",block:"",loading:h.value},{default:a(()=>[i("I have scan")]),_:1},8,["loading"])]),_:1})):y("v-if",!0),p.value&&p.value.status!=="LoginSuccess"?(c(),m(t(C),{key:2,title:"Warning",type:"warning"},{default:a(()=>[i(q(p.value.status),1)]),_:1})):y("v-if",!0)]}),_:1}))}});const L=P(T,[["__scopeId","data-v-21249173"],["__file","Request.vue"]]),E=b({__name:"request.html",setup(u){return(_,S)=>{const f=A("NaiveClient");return c(),R("div",null,[o(f,null,{default:a(()=>[o(t(L))]),_:1})])}}}),ae=P(E,[["__file","request.html.vue"]]);export{ae as default};
